<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Login e Cadastro de Alunos</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f2f2f2; }
    .container { max-width: 350px; margin: 60px auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 0 10px #ccc; }
    input, button { width: 100%; padding: 10px; margin: 8px 0; border-radius: 4px; border: 1px solid #ccc; }
    button { background: #007bff; color: #fff; border: none; cursor: pointer; }
    button:hover { background: #0056b3; }
    .msg { color: red; margin-bottom: 10px; }
    #area-treino { display:none; }
  </style>
</head>
<body>
<div class="container">
  <h2>Login / Cadastro</h2>
  <div id="login-area">
    <input type="text" id="nome" placeholder="Nome do aluno">
    <input type="password" id="senha" placeholder="Senha">
    <button onclick="login()">Entrar</button>
    <button onclick="cadastrar()">Cadastrar</button>
    <div class="msg" id="msg"></div>
  </div>

  <div id="area-treino">
    <h3>Bem-vindo, <span id="aluno-nome"></span>!</h3>
    <textarea id="treino" rows="5" placeholder="Digite seu treino aqui..."></textarea>
    <button onclick="salvarTreino()">Salvar Treino</button>
    <button onclick="logout()">Sair</button>
    <h4>Histórico de Treinos</h4>
    <ul id="historico"></ul>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyUFFwmr6R1435ZH4Z3rGk3KUC-VaA_Cg64JDlAF0Z43kX-2_h5DK-KUVA96eNJaMe8HQ/exec";

function mostrarMsg(msg) {
  document.getElementById("msg").innerText = msg;
}

function login() {
  const nome = document.getElementById("nome").value.trim();
  const senha = document.getElementById("senha").value.trim();
  if (!nome || !senha) return mostrarMsg("Preencha nome e senha!");
  fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({ acao: "login", nome, senha })
  })
  .then(r => r.json())
  .then(d => {
    if (d.status === "ok") {
      mostrarMsg("");
      document.getElementById("login-area").style.display = "none";
      document.getElementById("area-treino").style.display = "";
      document.getElementById("aluno-nome").innerText = nome;
      carregarHistorico(nome, senha);
      localStorage.setItem("aluno", nome);
      localStorage.setItem("senha", senha);
    } else {
      mostrarMsg(d.msg || "Erro ao logar");
    }
  });
}

function cadastrar() {
  const nome = document.getElementById("nome").value.trim();
  const senha = document.getElementById("senha").value.trim();
  if (!nome || !senha) return mostrarMsg("Preencha nome e senha!");
  fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({ acao: "cadastrar", nome, senha })
  })
  .then(r => r.json())
  .then(d => {
    if (d.status === "ok") {
      mostrarMsg("Cadastro realizado! Agora faça login.");
    } else {
      mostrarMsg(d.msg || "Erro ao cadastrar");
    }
  });
}

function salvarTreino() {
  const treino = document.getElementById("treino").value.trim();
  const nome = localStorage.getItem("aluno");
  const senha = localStorage.getItem("senha");
  if (!treino) return alert("Digite o treino!");
  fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({ acao: "salvar_treino", nome, senha, treino })
  })
  .then(r => r.json())
  .then(d => {
    if (d.status === "ok") {
      alert("Treino salvo!");
      document.getElementById("treino").value = "";
      carregarHistorico(nome, senha);
    } else {
      alert(d.msg || "Erro ao salvar treino");
    }
  });
}

function carregarHistorico(nome, senha) {
  fetch(API_URL, {
    method: "POST",
    body: new URLSearchParams({ acao: "historico", nome, senha })
  })
  .then(r => r.json())
  .then(d => {
    const ul = document.getElementById("historico");
    ul.innerHTML = "";
    if (d.status === "ok" && d.dados.length) {
      d.dados.forEach(item => {
        const li = document.createElement("li");
        li.textContent = `[${item.data}] ${item.treino}`;
        ul.appendChild(li);
      });
    } else {
      ul.innerHTML = "<li>Nenhum treino salvo ainda.</li>";
    }
  });
}

function logout() {
  localStorage.removeItem("aluno");
  localStorage.removeItem("senha");
  document.getElementById("area-treino").style.display = "none";
  document.getElementById("login-area").style.display = "";
}

window.onload = function() {
  // Autologin se já estiver logado
  const nome = localStorage.getItem("aluno");
  const senha = localStorage.getItem("senha");
  if (nome && senha) {
    document.getElementById("nome").value = nome;
    document.getElementById("senha").value = senha;
    login();
  }
};
</script>
</body>
</html>
